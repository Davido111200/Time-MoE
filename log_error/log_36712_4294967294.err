You are attempting to use Flash Attention 2.0 without specifying a torch dtype. This might lead to unexpected behaviour
Flash Attention 2.0 only supports torch.float16 and torch.bfloat16 dtypes, but the current dype in TimeMoeForPrediction is torch.float32. You should run training or inference using Automatic Mixed-Precision via the `with torch.autocast(device_type='torch_device'):` decorator, or load the model with the `torch_dtype` argument. Example: `model = AutoModel.from_pretrained("openai/whisper-tiny", attn_implementation="flash_attention_2", torch_dtype=torch.float16)`
Flash Attention 2.0 only supports torch.float16 and torch.bfloat16 dtypes, but the current dype in TimeMoeModel is torch.float32. You should run training or inference using Automatic Mixed-Precision via the `with torch.autocast(device_type='torch_device'):` decorator, or load the model with the `torch_dtype` argument. Example: `model = AutoModel.from_pretrained("openai/whisper-tiny", attn_implementation="flash_attention_2", torch_dtype=torch.float16)`
0it [00:00, ?it/s]The input hidden states seems to be silently casted in float32, this might be related to the fact you have upcasted embedding or layer norm layers in float32. We will cast back the input in torch.float32.
1it [00:02,  2.69s/it]5it [00:02,  2.35it/s]9it [00:02,  4.80it/s]13it [00:03,  7.74it/s]17it [00:03, 11.09it/s]21it [00:03, 14.67it/s]25it [00:03, 18.23it/s]29it [00:03, 21.61it/s]33it [00:03, 24.61it/s]37it [00:03, 26.96it/s]41it [00:03, 28.99it/s]45it [00:03, 30.63it/s]49it [00:04, 31.90it/s]53it [00:04, 32.80it/s]57it [00:04, 33.44it/s]61it [00:04, 33.91it/s]65it [00:04, 34.21it/s]69it [00:04, 34.22it/s]73it [00:04, 34.45it/s]77it [00:04, 34.60it/s]81it [00:04, 34.79it/s]85it [00:05, 34.91it/s]89it [00:05, 35.00it/s]93it [00:05, 35.02it/s]97it [00:05, 35.05it/s]101it [00:05, 34.84it/s]105it [00:05, 34.97it/s]109it [00:05, 35.04it/s]113it [00:05, 35.12it/s]117it [00:06, 35.26it/s]121it [00:06, 35.30it/s]125it [00:06, 35.29it/s]129it [00:06, 35.19it/s]133it [00:06, 35.03it/s]137it [00:06, 34.99it/s]141it [00:06, 35.00it/s]145it [00:06, 35.05it/s]149it [00:06, 35.07it/s]153it [00:07, 35.06it/s]157it [00:07, 35.07it/s]161it [00:07, 35.16it/s]165it [00:07, 35.12it/s]169it [00:07, 35.00it/s]173it [00:07, 35.01it/s]177it [00:07, 35.03it/s]181it [00:07, 35.09it/s]185it [00:07, 35.14it/s]189it [00:08, 35.19it/s]193it [00:08, 35.19it/s]197it [00:08, 35.24it/s]201it [00:08, 35.19it/s]205it [00:08, 35.10it/s]209it [00:08, 34.91it/s]213it [00:08, 34.76it/s]217it [00:08, 34.84it/s]221it [00:08, 34.86it/s]225it [00:09, 34.93it/s]229it [00:09, 34.96it/s]233it [00:09, 34.93it/s]237it [00:09, 34.91it/s]241it [00:09, 34.90it/s]245it [00:09, 34.83it/s]249it [00:09, 34.65it/s]253it [00:09, 34.79it/s]257it [00:10, 34.88it/s]261it [00:10, 34.99it/s]265it [00:10, 35.10it/s]269it [00:10, 35.21it/s]273it [00:10, 35.31it/s]277it [00:10, 35.29it/s]281it [00:10, 35.35it/s]285it [00:10, 35.35it/s]289it [00:10, 35.40it/s]293it [00:11, 35.42it/s]297it [00:11, 35.36it/s]301it [00:11, 35.32it/s]305it [00:11, 35.23it/s]309it [00:11, 35.08it/s]313it [00:11, 35.02it/s]317it [00:11, 35.07it/s]321it [00:11, 35.13it/s]325it [00:11, 35.18it/s]329it [00:12, 35.06it/s]333it [00:12, 35.06it/s]337it [00:12, 35.09it/s]341it [00:12, 35.14it/s]345it [00:12, 35.26it/s]349it [00:12, 35.37it/s]353it [00:12, 35.43it/s]357it [00:12, 35.39it/s]361it [00:12, 35.43it/s]365it [00:13, 35.38it/s]369it [00:13, 35.34it/s]373it [00:13, 35.26it/s]377it [00:13, 35.21it/s]381it [00:13, 35.03it/s]385it [00:13, 35.00it/s]389it [00:13, 34.96it/s]393it [00:13, 34.97it/s]397it [00:13, 34.93it/s]401it [00:14, 34.89it/s]405it [00:14, 34.85it/s]409it [00:14, 34.75it/s]413it [00:14, 34.72it/s]417it [00:14, 34.71it/s]421it [00:14, 34.73it/s]425it [00:14, 34.76it/s]429it [00:14, 34.77it/s]433it [00:15, 34.69it/s]437it [00:15, 34.87it/s]441it [00:15, 35.00it/s]445it [00:15, 35.19it/s]449it [00:15, 35.34it/s]453it [00:15, 35.41it/s]457it [00:15, 35.33it/s]461it [00:15, 35.26it/s]465it [00:15, 35.21it/s]469it [00:16, 35.16it/s]473it [00:16, 35.10it/s]477it [00:16, 35.10it/s]481it [00:16, 35.13it/s]485it [00:16, 34.88it/s]489it [00:16, 34.92it/s]493it [00:16, 34.93it/s]497it [00:16, 34.93it/s]501it [00:16, 34.97it/s]505it [00:17, 35.10it/s]509it [00:17, 35.30it/s]513it [00:17, 35.40it/s]517it [00:17, 35.49it/s]521it [00:17, 35.47it/s]525it [00:17, 35.47it/s]529it [00:17, 35.57it/s]533it [00:17, 35.52it/s]537it [00:17, 35.34it/s]541it [00:18, 35.38it/s]545it [00:18, 35.40it/s]549it [00:18, 35.27it/s]553it [00:18, 35.33it/s]557it [00:18, 35.36it/s]561it [00:18, 35.35it/s]565it [00:18, 35.32it/s]569it [00:18, 35.32it/s]573it [00:18, 35.32it/s]577it [00:19, 35.21it/s]581it [00:19, 35.12it/s]585it [00:19, 35.02it/s]589it [00:19, 34.96it/s]593it [00:19, 34.89it/s]597it [00:19, 34.89it/s]601it [00:19, 34.84it/s]605it [00:19, 34.72it/s]609it [00:20, 34.78it/s]613it [00:20, 34.81it/s]617it [00:20, 34.88it/s]621it [00:20, 34.92it/s]625it [00:20, 35.01it/s]629it [00:20, 35.03it/s]633it [00:20, 35.11it/s]637it [00:20, 35.12it/s]641it [00:20, 35.03it/s]645it [00:21, 34.96it/s]649it [00:21, 34.96it/s]653it [00:21, 34.97it/s]657it [00:21, 35.06it/s]661it [00:21, 35.18it/s]665it [00:21, 35.15it/s]669it [00:21, 35.11it/s]673it [00:21, 35.05it/s]677it [00:21, 35.09it/s]681it [00:22, 35.10it/s]685it [00:22, 35.13it/s]689it [00:22, 35.19it/s]693it [00:22, 35.25it/s]697it [00:22, 35.24it/s]701it [00:22, 35.25it/s]705it [00:22, 35.23it/s]709it [00:22, 35.24it/s]713it [00:22, 35.22it/s]717it [00:23, 35.11it/s]721it [00:23, 35.11it/s]725it [00:23, 35.07it/s]729it [00:23, 35.09it/s]733it [00:23, 35.11it/s]737it [00:23, 34.89it/s]741it [00:23, 34.85it/s]745it [00:23, 34.89it/s]749it [00:24, 34.92it/s]753it [00:24, 34.88it/s]757it [00:24, 34.85it/s]761it [00:24, 34.78it/s]765it [00:24, 34.80it/s]769it [00:24, 34.79it/s]773it [00:24, 34.79it/s]777it [00:24, 34.79it/s]781it [00:24, 34.77it/s]785it [00:25, 34.82it/s]789it [00:25, 34.90it/s]793it [00:25, 35.00it/s]797it [00:25, 35.02it/s]801it [00:25, 35.06it/s]805it [00:25, 34.95it/s]809it [00:25, 34.94it/s]813it [00:25, 34.96it/s]817it [00:25, 34.93it/s]821it [00:26, 34.95it/s]825it [00:26, 34.96it/s]829it [00:26, 34.95it/s]833it [00:26, 34.91it/s]837it [00:26, 34.89it/s]841it [00:26, 34.91it/s]845it [00:26, 34.97it/s]849it [00:26, 34.96it/s]853it [00:26, 34.94it/s]857it [00:27, 35.09it/s]861it [00:27, 35.13it/s]865it [00:27, 35.20it/s]869it [00:27, 35.22it/s]873it [00:27, 35.14it/s]877it [00:27, 35.04it/s]881it [00:27, 35.01it/s]885it [00:27, 35.07it/s]889it [00:28, 35.20it/s]893it [00:28, 35.03it/s]897it [00:28, 35.04it/s]901it [00:28, 35.05it/s]905it [00:28, 34.98it/s]909it [00:28, 34.98it/s]913it [00:28, 34.99it/s]917it [00:28, 34.86it/s]921it [00:28, 34.78it/s]925it [00:29, 34.80it/s]929it [00:29, 34.83it/s]933it [00:29, 34.83it/s]937it [00:29, 34.83it/s]941it [00:29, 34.86it/s]945it [00:29, 34.81it/s]949it [00:29, 34.80it/s]953it [00:29, 34.82it/s]957it [00:29, 34.88it/s]961it [00:30, 34.86it/s]965it [00:30, 34.88it/s]969it [00:30, 34.88it/s]973it [00:30, 34.89it/s]977it [00:30, 34.78it/s]981it [00:30, 34.72it/s]985it [00:30, 34.73it/s]989it [00:30, 34.75it/s]993it [00:30, 34.80it/s]997it [00:31, 34.80it/s]1001it [00:31, 34.82it/s]1005it [00:31, 34.81it/s]1009it [00:31, 34.86it/s]1013it [00:31, 34.92it/s]1017it [00:31, 34.96it/s]1021it [00:31, 34.95it/s]1025it [00:31, 34.88it/s]1029it [00:32, 34.86it/s]1033it [00:32, 34.88it/s]1037it [00:32, 34.84it/s]1041it [00:32, 34.83it/s]1045it [00:32, 34.90it/s]1049it [00:32, 34.93it/s]1053it [00:32, 34.98it/s]1057it [00:32, 35.06it/s]1061it [00:32, 35.08it/s]1065it [00:33, 35.01it/s]1069it [00:33, 35.01it/s]1073it [00:33, 35.03it/s]1077it [00:33, 35.03it/s]1081it [00:33, 35.12it/s]1085it [00:33, 35.09it/s]1089it [00:33, 35.11it/s]1093it [00:33, 35.18it/s]1097it [00:33, 35.23it/s]1101it [00:34, 35.29it/s]1105it [00:34, 35.35it/s]1109it [00:34, 35.37it/s]1113it [00:34, 35.29it/s]1117it [00:34, 35.20it/s]1121it [00:34, 35.16it/s]1125it [00:34, 35.09it/s]1129it [00:34, 35.02it/s]1133it [00:34, 34.91it/s]1137it [00:35, 34.94it/s]1141it [00:35, 34.93it/s]1145it [00:35, 34.97it/s]1149it [00:35, 34.99it/s]1153it [00:35, 34.83it/s]1157it [00:35, 34.97it/s]1161it [00:35, 35.05it/s]1165it [00:35, 35.09it/s]1169it [00:36, 35.08it/s]1173it [00:36, 35.00it/s]1177it [00:36, 34.98it/s]1181it [00:36, 34.98it/s]1185it [00:36, 34.97it/s]1189it [00:36, 34.94it/s]1193it [00:36, 34.90it/s]1197it [00:36, 34.81it/s]1201it [00:36, 34.77it/s]1205it [00:37, 34.82it/s]1209it [00:37, 34.91it/s]1213it [00:37, 34.98it/s]1217it [00:37, 35.11it/s]1221it [00:37, 35.10it/s]1225it [00:37, 35.11it/s]1229it [00:37, 35.15it/s]1233it [00:37, 35.21it/s]1237it [00:37, 35.11it/s]1241it [00:38, 34.96it/s]1245it [00:38, 35.03it/s]1249it [00:38, 35.07it/s]1253it [00:38, 35.13it/s]1257it [00:38, 35.13it/s]1261it [00:38, 35.09it/s]1265it [00:38, 34.76it/s]1269it [00:38, 34.76it/s]1273it [00:38, 34.84it/s]1277it [00:39, 34.85it/s]1281it [00:39, 34.87it/s]1285it [00:39, 34.93it/s]1289it [00:39, 34.95it/s]1293it [00:39, 34.92it/s]1297it [00:39, 34.89it/s]1301it [00:39, 34.82it/s]1305it [00:39, 34.85it/s]1309it [00:40, 34.84it/s]1313it [00:40, 34.82it/s]1317it [00:40, 34.94it/s]1321it [00:40, 34.95it/s]1325it [00:40, 34.98it/s]1329it [00:40, 35.02it/s]1333it [00:40, 35.03it/s]1337it [00:40, 35.09it/s]1341it [00:40, 35.17it/s]1345it [00:41, 35.25it/s]1349it [00:41, 35.31it/s]1353it [00:41, 35.09it/s]1357it [00:41, 35.09it/s]1361it [00:41, 35.06it/s]1365it [00:41, 34.99it/s]1369it [00:41, 34.98it/s]1373it [00:41, 34.97it/s]1377it [00:41, 35.03it/s]1381it [00:42, 35.08it/s]1385it [00:42, 35.11it/s]1389it [00:42, 35.18it/s]1393it [00:42, 35.14it/s]1397it [00:42, 35.17it/s]1401it [00:42, 35.18it/s]1405it [00:42, 35.22it/s]1409it [00:42, 35.34it/s]1413it [00:42, 35.38it/s]1417it [00:43, 35.20it/s]1421it [00:43, 35.19it/s]1425it [00:43, 35.22it/s]1429it [00:43, 35.23it/s]1433it [00:43, 35.12it/s]1437it [00:43, 35.08it/s]1441it [00:43, 35.01it/s]1445it [00:43, 34.87it/s]1449it [00:44, 34.71it/s]1453it [00:44, 34.66it/s]1457it [00:44, 34.51it/s]1461it [00:44, 34.47it/s]1465it [00:44, 34.37it/s]1469it [00:44, 34.55it/s]1473it [00:44, 34.83it/s]1477it [00:44, 35.07it/s]1481it [00:44, 35.16it/s]1485it [00:45, 35.29it/s]1486it [00:45, 32.86it/s]
